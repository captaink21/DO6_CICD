# Basic CI/CD

### Part 1. Настройка **gitlab-runner**

![Снимок экрана 2024-12-24 в 13.42.44.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-24_%25D0%25B2_13.42.44.png)

1. Запуск ubuntu 22.04.5

![Снимок экрана 2024-12-24 в 15.49.16.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-24_%25D0%25B2_15.49.16.png)

2. Установка и регистрация **gitlab-runner** 

![Снимок экрана 2024-12-26 в 12.30.36.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_12.30.36.png)

3. запуск  раннера

### Part 2. Сборка

![Снимок экрана 2024-12-26 в 12.44.35.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_12.44.35.png)

1. Создание файла *gitlab-ci.yml* и запуск этапа сборки проекта simplebash с учетом хранения артефактов в течении 30 дней

![Снимок экрана 2024-12-26 в 12.45.30.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_12.45.30.png)

2. Скрин выполнения этапа сборки

### Part 3. Тест кодстайла

![Снимок экрана 2024-12-26 в 15.29.24.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_15.29.24.png)

1. Добавление в *gitlab-ci.yml этапа проверки код стайла*

![Снимок экрана 2024-12-26 в 16.06.33.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.06.33.png)

![Снимок экрана 2024-12-26 в 16.06.42.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.06.42.png)

2. Скрин успешного прохождения этапа проверки стилю

### Part 4. Интеграционные тесты

``

![Снимок экрана 2024-12-26 в 16.04.34.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.04.34.png)

1. Добавление в *gitlab-ci.yml этапа прохождения тестов*

![Снимок экрана 2024-12-26 в 16.06.33.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.06.33%201.png)

![Снимок экрана 2024-12-26 в 16.06.42.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.06.42%201.png)

2. Скрин успешного прохождения тестов

![Снимок экрана 2024-12-26 в 16.16.12.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.16.12.png)

![Снимок экрана 2024-12-26 в 16.16.23.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_16.16.23.png)

3. После добавлении заранее ошибочной проверки diff <(./s21_cat test_5_cat.txt) <(echo "0") скрин с  фейлом пайплайна

### 

### Part 5. Этап деплоя

****

![Снимок экрана 2025-01-04 в 18.13.15.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2025-01-04_%25D0%25B2_18.13.15.png)

1. Добавление в *gitlab-ci.yml этапа деплоя (копирование артифактов на вторую машину)*

![Снимок экрана 2024-12-26 в 18.16.01.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_18.16.01.png)

2. После клонирование виртуальной машины скрин изменений конфигураций для связывания машин между собой

![Снимок экрана 2024-12-26 в 19.44.22.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_19.44.22.png)

![Снимок экрана 2024-12-26 в 19.44.39.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-26_%25D0%25B2_19.44.39.png)

3. Для связывания машин между собой генерим ssh ключ и копируем его на вторую машину

![Снимок экрана 2025-01-04 в 18.08.34.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2025-01-04_%25D0%25B2_18.08.34.png)

4. bash-скрипт, который при помощи **ssh** и **scp** копирует файлы, полученные после сборки (артефакты), в директорию */usr/local/bin* второй виртуальной машины.

![Снимок экрана 2024-12-31 в 11.30.47.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2024-12-31_%25D0%25B2_11.30.47.png)

5. Скрин успешного копирование артефактов на вторую машину

### Part 6. Дополнительно. Уведомления

![Снимок экрана 2025-01-04 в 18.18.04.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2025-01-04_%25D0%25B2_18.18.04.png)

1. Создаем токен нового бота через BotFather в телеграмме

![Снимок экрана 2025-01-04 в 18.21.11.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2025-01-04_%25D0%25B2_18.21.11.png)

2. Создаем файл [notify.sh](http://notify.sh)  с добавлением в шаблон статуса выполнения

![Снимок экрана 2025-01-04 в 18.24.20.png](Basic%20CI%20CD%20166a313fb7018003a335e0767643f2b5/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B0_2025-01-04_%25D0%25B2_18.24.20.png)

3. После успешного прохождения каждого этапа пайплайна в телеграмм бот приходит уведомление